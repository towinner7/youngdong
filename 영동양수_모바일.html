<!DOCTYPE html>
<html>
<head>
<script type="javascript" charset="UTF-8" src="/script.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, 
  maximum-scale=1.0, minimum-scale=1.0"
    <title>영동양수</title>
<style>
html, body { height: 99%; }
#container {overflow:hidden;height:85%;position:relative;}
#mapWrapper {width:100%;height:100%;z-index:1;}
#rvWrapper {width:50%;height:100%;top:0;right:0;position:absolute;z-index:0;}
#container.view_roadview #mapWrapper {width: 50%;}
#roadviewControl {position:absolute;top:5px;left:5px;width:42px;height:42px;z-index: 1;cursor: pointer; background: url(https://t1.daumcdn.net/localimg/localimages/07/2018/pc/common/img_search.png) 0 -450px no-repeat;}
#roadviewControl.active {background-position:0 -350px;}
#close {position: absolute;padding: 4px;top: 5px;left: 5px;cursor: pointer;background: #fff;border-radius: 4px;border: 1px solid #c8c8c8;box-shadow: 0px 1px #888;}
#close .img {display: block;background: url(https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/rv_close.png) no-repeat;width: 14px;height: 14px;}
</style>
</head>
<body>
<div id="container">
    <div id="rvWrapper">
        <div id="roadview" style="width:100%;height:100%;"> </div> <!-- 로드뷰를 표시할 div 입니다 -->
        <div id="close" title="로드뷰닫기" onclick="closeRoadview()"> <span class="img"></span> </div>
    </div>
    <div id="mapWrapper">
        <div id="map" style="width:100%;height:100%;"> </div> <!-- 지도를 표시할 div 입니다 -->
        <div id="roadviewControl" onclick="setRoadviewRoad()"> </div>
    </div>
</div>
<Style type="text/css">
    .bAddr {padding:5px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap;}
</Style>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a148ff6374735d9362fa5a525d7d99ff&libraries=services,drawing"> </script>
<script>
var overlayOn = false, // 지도 위에 로드뷰 오버레이가 추가된 상태를 가지고 있을 변수
    container = document.getElementById('container'), // 지도와 로드뷰를 감싸고 있는 div 입니다
    mapWrapper = document.getElementById('mapWrapper'), // 지도를 감싸고 있는 div 입니다
    mapContainer = document.getElementById('map'), // 지도를 표시할 div 입니다
    rvContainer = document.getElementById('roadview'); //로드뷰를 표시할 div 입니다
var mapCenter = new kakao.maps.LatLng(36.0881256931438, 127.816125221851),
    mapOption = {
        center: mapCenter, // 지도의 중심좌표
        level: 3, // 지도의 확대 레벨
        mapTypeId: daum.maps.MapTypeId.HYBRID
    };
    var map = new daum.maps.Map(mapContainer, mapOption);
    var mapTypeControl = new daum.maps.MapTypeControl();
        map.addControl(mapTypeControl, daum.maps.ControlPosition.TOPRIGHT);
    var zoomControl = new daum.maps.ZoomControl();
        map.addControl(zoomControl, daum.maps.ControlPosition.RIGHT);
        customOverlay = new kakao.maps.CustomOverlay({}),
        infowindow = new kakao.maps.InfoWindow({removable: true});
var rv = new kakao.maps.Roadview(rvContainer);
var rvClient = new kakao.maps.RoadviewClient();
kakao.maps.event.addListener(rv, 'position_changed', function() {
    var rvPosition = rv.getPosition();
    map.setCenter(rvPosition);
    if(overlayOn) {
        marker0.setPosition(rvPosition); } });
var markImage = new kakao.maps.MarkerImage(
    'https://t1.daumcdn.net/localimg/localimages/07/2018/pc/roadview_minimap_wk_2018.png',
    new kakao.maps.Size(26, 46),
    {
        spriteSize: new kakao.maps.Size(1666, 168),
        spriteOrigin: new kakao.maps.Point(705, 114),
        offset: new kakao.maps.Point(13, 46)
    }
);



var marker0 = new kakao.maps.Marker({    image : markImage,    position: mapCenter,    draggable: true});
kakao.maps.event.addListener(marker0, 'dragend', function(mouseEvent) {    var position = marker0.getPosition();    toggleRoadview(position);});
kakao.maps.event.addListener(map, 'click', function(mouseEvent){ if(!overlayOn) { return; } var position = mouseEvent.latLng; marker0.setPosition(position); toggleRoadview(position);});
function toggleRoadview(position){ rvClient.getNearestPanoId(position, 50, function(panoId) { if (panoId === null) { toggleMapWrapper(true, position); } else { toggleMapWrapper(false, position); rv.setPanoId(panoId, position); } }); }
function toggleMapWrapper(active, position) { if (active) { container.className = ''; map.relayout(); map.setCenter(position);
        } else { if (container.className.indexOf('view_roadview') === -1) { container.className = 'view_roadview'; map.relayout(); map.setCenter(position); } } }
function toggleOverlay(active) { if (active) { overlayOn = true; map.addOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW); marker0.setMap(map); marker0.setPosition(map.getCenter()); toggleRoadview(map.getCenter());
        } else { overlayOn = false; map.removeOverlayMapTypeId(kakao.maps.MapTypeId.ROADVIEW); marker0.setMap(null); } }
function setRoadviewRoad() { var control = document.getElementById('roadviewControl'); if (control.className.indexOf('active') === -1) { control.className = 'active'; toggleOverlay(true);
        } else { control.className = ''; toggleOverlay(false); } }
function closeRoadview() { var position = marker0.getPosition(); toggleMapWrapper(true, position); }
var pipeline1 = [
new daum.maps.LatLng(36.0910070843924,127.794651909139),
new daum.maps.LatLng(36.0909912559542,127.794794924736)
];
var polyline1 = new daum.maps.Polyline({
path: pipeline1,
strokeWeight: 1,
strokeColor: '#00FFFF',
strokeOpacity: 1,
strokeStyle: 'solid'
});
polyline1.setMap(map);


var currentTypeId;
function setOverlayMapTypeId(maptype) { var changeMaptype;
    if (maptype === 'addmapdelete') {
    if (currentTypeId) { map.removeOverlayMapTypeId(currentTypeId); }
    } else  if (maptype === 'traffic') {
        changeMaptype = kakao.maps.MapTypeId.TRAFFIC;
    if (currentTypeId) { map.removeOverlayMapTypeId(currentTypeId); }
    map.addOverlayMapTypeId(changeMaptype);
    currentTypeId = changeMaptype;
    } else  if (maptype === 'terrain') {
        changeMaptype = kakao.maps.MapTypeId.TERRAIN;
    if (currentTypeId) { map.removeOverlayMapTypeId(currentTypeId); }
    map.addOverlayMapTypeId(changeMaptype);
    currentTypeId = changeMaptype;
    } else  if (maptype === 'use_district') {
        changeMaptype = kakao.maps.MapTypeId.USE_DISTRICT;
    if (currentTypeId) { map.removeOverlayMapTypeId(currentTypeId); }
    map.addOverlayMapTypeId(changeMaptype);
    currentTypeId = changeMaptype;
    }
}

var marker1;
        var markers1 = [];
        var j = 0;
        var yesum = 0;
        var xnsum = 0;
        var mapContainer = document.getElementById('map');
        var mapOption = {
            center: new daum.maps.LatLng(37.566535, 126.9779692), // Seoul coordinates as default center
            level: 3
        };
        var map = new daum.maps.Map(mapContainer, mapOption);

        function removeMarker() {
            for (var i = 0; i < markers1.length; i++) {
                markers1[i].setMap(null);
            }
            markers1 = [];
        }

        var options = { enableHighAccuracy: true };

        if (navigator.geolocation) {
            navigator.geolocation.watchPosition(success, error, options);
        } else {
            document.getElementById('text').innerHTML = '이 브라우저에서는 Geolocation이 지원되지 않습니다.';
        }

        function error(e) {
            document.getElementById('text').innerHTML = 'Geolocation 오류 ' + e.code + ': ' + e.message;
        }

        function calculateTMCoordinates(latitude, longitude) {
            var a = 6378137;
            var f = 1 / 298.257222101;
            var b = a * (1 - f);
            var e21 = (Math.pow(a, 2) - Math.pow(b, 2)) / Math.pow(a, 2);
            var e22 = (Math.pow(a, 2) - Math.pow(b, 2)) / Math.pow(b, 2);
            var phig = latitude;
            var lambdag = longitude;
            var radPhi = phig * Math.PI / 180;
            var radLambda = lambdag * Math.PI / 180;
            var radLambda0 = 127 * Math.PI / 180;

            var M0 = a * ((1 - e21 / 4 - 3 * Math.pow(e21, 2) / 64 - 5 * Math.pow(e21, 3) / 256) * (38 * Math.PI / 180) +
                (-3 * e21 / 8 - 3 * Math.pow(e21, 2) / 32 - 45 * Math.pow(e21, 3) / 1024) * Math.sin(2 * 38 * Math.PI / 180) +
                (15 * Math.pow(e21, 2) / 256 + 45 * Math.pow(e21, 3) / 1024) * Math.sin(4 * 38 * Math.PI / 180) -
                35 * Math.pow(e21, 3) / 3072 * Math.sin(6 * 38 * Math.PI / 180));

            var M = a * ((1 - e21 / 4 - 3 * Math.pow(e21, 2) / 64 - 5 * Math.pow(e21, 3) / 256) * radPhi +
                (-3 * e21 / 8 - 3 * Math.pow(e21, 2) / 32 - 45 * Math.pow(e21, 3) / 1024) * Math.sin(2 * radPhi) +
                (15 * Math.pow(e21, 2) / 256 + 45 * Math.pow(e21, 3) / 1024) * Math.sin(4 * radPhi) -
                35 * Math.pow(e21, 3) / 3072 * Math.sin(6 * radPhi));

            var N = a / Math.sqrt(1 - e21 * Math.pow(Math.sin(radPhi), 2));
            var A = (radLambda - radLambda0) * Math.cos(radPhi);
            var T = Math.pow(Math.tan(radPhi), 2);
            var C = e21 / (1 - e21) * Math.pow(Math.cos(radPhi), 2);

            var YE = 200000 + N * (A + Math.pow(A, 3) / 6 * (1 - T + C) + Math.pow(A, 5) / 120 * (5 - 18 * T + Math.pow(T, 2) + 72 * C - 58 * e22));
            var XN = 600000 + (M - M0 + N * Math.tan(radPhi) * (Math.pow(A, 2) / 2 + Math.pow(A, 4) / 24 * (5 - T + 9 * C + 4 * Math.pow(C, 2)) +
                Math.pow(A, 6) / 720 * (61 - 58 * T + Math.pow(T, 2) + 600 * C - 330 * e22)));

            return { YE: YE, XN: XN };
        }

        function success(pos) {
            var latitude = pos.coords.latitude;
            var longitude = pos.coords.longitude;

            var imageSrc = 'https://2.bp.blogspot.com/-Hb-8D2y7_qs/WVodUIrn5CI/AAAAAAAA2Ok/0rnf47BNY_8-lUI0XvfOOae9SRIv75GwQCLcBGAs/s1600/%25EC%25A7%2584%25EC%25A3%25BC%2B%25EC%25A0%259C%25EC%2588%2598%25EB%25B0%25B8%25EB%25B8%258C%2B%25EC%25A0%2581%25EC%2583%2589%2B.png';
            var imageSize = new daum.maps.Size(17, 17);
            var imageOption = { offset: new daum.maps.Point(8, 8) };
            var markerImage = new daum.maps.MarkerImage(imageSrc, imageSize, imageOption);
            var markerPosition = new daum.maps.LatLng(latitude, longitude);

            if (!marker1) {
                marker1 = new daum.maps.Marker({
                    position: markerPosition,
                    image: markerImage,
                    title: '제수변 마크 중심이 지도 아래의 좌표값입니다.'
                });
            } else {
                marker1.setPosition(markerPosition);
            }

            marker1.setMap(map);

            var { YE, XN } = calculateTMCoordinates(latitude, longitude);

            j += 1;
            yesum += YE;
            xnsum += XN;

            var yeaverage = yesum / j;
            var xnaverage = xnsum / j;

            var tmxy = `${j}번째, ${new Date(pos.timestamp).toLocaleString()} 중부원점 TM좌표 E:${YE.toFixed(3)},N:${XN.toFixed(3)} 오차범위:${pos.coords.accuracy.toFixed(3)}m ${j}회 평균 E:${yeaverage.toFixed(3)}, N:${xnaverage.toFixed(3)}`;
            document.getElementById('text').innerHTML = tmxy;
        }

  function getLocation() {
  

  


  
  
  
  if (navigator.geolocation) { // GPS를 지원하면
    navigator.geolocation.getCurrentPosition(function(position) {
      
          // var moveLatLon = new kakao.maps.LatLng(position.coords.latitude, position.coords.longitude);
          
          var lat = position.coords.latitude,  // 위도
              lon = position.coords.longitude; // 경도
    
    // 지도 중심을 부드럽게 이동시킵니다
    // 만약 이동할 거리가 지도 화면보다 크면 부드러운 효과 없이 이동합니다
    // map.panTo(moveLatLon);            
    
    	var locPosition = new kakao.maps.LatLng(lat, lon); // 마커가 표시될 위치를 geolocation으로 얻어온 좌표로 생성합니다
    
    
    // var marker = new kakao.maps.Marker({  
    //    map: map, 
    //    position: moveLatLon
    // });
    
    // marker.setMap(map);
       
    //    removeMarker();
        
     // 마커와 인포윈도우를 표시합니다
  //      displayMarker(moveLatLon, "your point");
    
    displayMarker(locPosition,"");
      
      
      
      
      alert(position.coords.latitude + ' ' + position.coords.longitude);
    }, function(error) {
      console.error(error);
    }, {
      enableHighAccuracy: false,
      maximumAge: 0,
      timeout: Infinity


    });
  } else {
    alert('GPS를 지원하지 않습니다');
  }



  }




 //지도에 마커와 인포윈도우를 표시하는 함수입니다
function displayMarker(locPosition, message) {

    // 마커를 생성합니다
        var marker = new kakao.maps.Marker({  
        map: map, 
        position: locPosition
    }); 
    
    
    marker.setMap(null);
    //var iwContent = message, // 인포윈도우에 표시할 내용
    //    iwRemoveable = true;

    // 인포윈도우를 생성합니다
    // var infowindow = new kakao.maps.InfoWindow({
    //    content : iwContent,
    //    removable : iwRemoveable
    // });
    
    // 인포윈도우를 마커위에 표시합니다 
    marker.setMap(map);
    marker.setPosition(locPosition);
    // 지도 중심좌표를 접속위치로 변경합니다
    map.setCenter(locPosition);      
    return
}




































    
    
//};

</script>
<p>
<button onclick="setOverlayMapTypeId('addmapdelete')">지도타입 안보기</button>
<button onclick="setOverlayMapTypeId('traffic')">교통정보 보기</button>
<button onclick="setOverlayMapTypeId('terrain')">지형정보 보기</button>
<button onclick="setOverlayMapTypeId('use_district')">지적편집도 보기</button>
<button onclick="getLocation()">현위치</button>
</p>
</body>
</html>